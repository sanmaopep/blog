{"version":3,"file":"main.js","sources":["../../src/js/lib/nav.js","../../src/js/main.js"],"sourcesContent":["// 上下Nav移动\r\nfunction storyState() {\r\n\r\n    this.storyOutterDOM = document.querySelector(\".ui-content-story-outter\");\r\n    this.uiNavItems = document.querySelectorAll(\".ui-nav-container li\");\r\n\r\n    // story全部不可见\r\n    this.stories = this.storyOutterDOM.children;\r\n    this.storiesLen = this.stories.length;\r\n\r\n    for (let i = 0; i < this.storiesLen; i++) {\r\n        this.stories[i].style.visibility = \"hidden\";\r\n        this.stories[i].style.display = \"none\";\r\n        this.stories[i].style.opacity = \"0\";\r\n        this.stories[i].style.position = \"relative\";\r\n        this.stories[i].style.left = \"-30px\";\r\n        // 自己在CSS中添加transition属性\r\n    }\r\n\r\n    this.curr = 0;\r\n    this._setCurrIndex(0);\r\n\r\n    // 初始化左部导航\r\n    if (this.uiNavItems) {\r\n        let len = this.uiNavItems.length;\r\n        let selector = this.uiNavItems[0];\r\n\r\n        // 初始化\r\n        selector.style.top = this.uiNavItems[this.curr + 1].offsetTop - 6 + \"px\";\r\n\r\n        for (let i = 1; i < len; i++) {\r\n            // 添加事件侦听\r\n            this.uiNavItems[i].addEventListener('mouseover', () => {\r\n                selector.style.top = this.uiNavItems[i].offsetTop - 6 + \"px\";\r\n            })\r\n\r\n            this.uiNavItems[i].addEventListener('mouseout', () => {\r\n                if (this.setCurrIndexBlock) {\r\n                    return;\r\n                }\r\n                selector.style.top = this.uiNavItems[this.curr + 1].offsetTop - 6 + \"px\";\r\n            })\r\n\r\n            this.uiNavItems[i].addEventListener('click', () => {\r\n                this._setCurrIndex(i - 1);\r\n            })\r\n\r\n        }\r\n    }\r\n\r\n\r\n    // 滚轮事件\r\n    this._mouseWheel = this._mouseWheel.bind(this)\r\n    this.storyOutterDOM.addEventListener('mousewheel', this._mouseWheel)\r\n    document.addEventListener('mousewheel', this._mouseWheel)\r\n\r\n\r\n    // 移动端Nav\r\n    this.trigger = false;\r\n    this._triggerMobileNav = this._triggerMobileNav.bind(this);\r\n    this._untriggerMobileNav = this._untriggerMobileNav.bind(this);\r\n    document.querySelector(\".ui-mobile-nav-trigger\")\r\n        .addEventListener(\"click\", this._triggerMobileNav);\r\n    document.querySelector(\".ui-nav-container\")\r\n        .addEventListener(\"click\", event => {\r\n            event.stopPropagation()\r\n        })\r\n    document.body.addEventListener(\"click\", this._untriggerMobileNav);\r\n\r\n    // 移动端touch事件\r\n    this._touchHandler = this._touchHandler.bind(this);\r\n    let contentArticle = document.querySelector(\".ui-content-article\");\r\n    contentArticle.addEventListener('touchstart', this._touchHandler)\r\n    contentArticle.addEventListener('touchend', this._touchHandler)\r\n    contentArticle.addEventListener('touchmove', this._touchHandler)\r\n}\r\n\r\n// 移动端touch事件处理\r\nstoryState.prototype._touchHandler = function (event) {\r\n    let touchY, deltaTouch;\r\n    switch (event.type) {\r\n        case \"touchend\":\r\n            deltaTouch = this.endTouch - this.startTouch;\r\n            if (deltaTouch > 0) {\r\n                if (this.storyOutterDOM.scrollTop === 0) {\r\n                    this._upStory();\r\n                }\r\n            } else {\r\n                let scrollTop = this.storyOutterDOM.scrollTop;\r\n                let offsetHeight = this.storyOutterDOM.offsetHeight;\r\n                let scrollHeight = this.storyOutterDOM.scrollHeight;\r\n\r\n                if (scrollTop + offsetHeight >= scrollHeight) {\r\n                    this._downStory();\r\n                }\r\n            }\r\n            break;\r\n\r\n        case \"touchstart\":\r\n            touchY = event.touches[0].clientY;\r\n            this.startTouch = touchY;\r\n            break;\r\n\r\n        case \"touchmove\":\r\n            touchY = event.touches[0].clientY;\r\n            this.endTouch = touchY;\r\n            break;\r\n    }\r\n}\r\n\r\n\r\n// 移动端显示Nav\r\nstoryState.prototype._triggerMobileNav = function (event) {\r\n    event.stopPropagation();\r\n    let navContainer = document.querySelector(\".ui-nav-container\");\r\n    if (this.trigger) {\r\n        navContainer.classList.remove(\"ui-mobile-show\");\r\n        this.trigger = false;\r\n    } else {\r\n        navContainer.classList.add(\"ui-mobile-show\");\r\n        this.trigger = true;\r\n    }\r\n\r\n}\r\n\r\nstoryState.prototype._untriggerMobileNav = function (event) {\r\n    let navContainer = document.querySelector(\".ui-nav-container\");\r\n    if (this.trigger) {\r\n        navContainer.classList.remove(\"ui-mobile-show\");\r\n        this.trigger = false;\r\n    }\r\n}\r\n\r\n// 鼠标滚动事件\r\nstoryState.prototype._mouseWheel = function (event) {\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n    let flag = 5;\r\n    let ratio = 5;\r\n    let animation = setInterval(() => {\r\n        this.storyOutterDOM.scrollTop += event.deltaY > 0 ? ratio * flag : -ratio * flag;\r\n        if (flag-- <= 0) {\r\n            clearInterval(animation)\r\n        }\r\n    }, 25);\r\n    // 让内部也随之滚动\r\n    if (event.deltaY < 0) {\r\n        //判断是否滚到头部\r\n        if (this.storyOutterDOM.scrollTop === 0) {\r\n            this._upStory();\r\n        }\r\n    } else if (event.deltaY > 0) {\r\n        // 判断是否滚到底部\r\n        let scrollTop = this.storyOutterDOM.scrollTop;\r\n        let offsetHeight = this.storyOutterDOM.offsetHeight;\r\n        let scrollHeight = this.storyOutterDOM.scrollHeight;\r\n\r\n        if (scrollTop + offsetHeight >= scrollHeight) {\r\n            this._downStory();\r\n        }\r\n\r\n    }\r\n}\r\n\r\n// 设置当前幻灯片\r\nstoryState.prototype._setCurrIndex = function (index, cb) {\r\n    // 保护锁\r\n    if (this.setCurrIndexBlock) {\r\n        return;\r\n    }\r\n    this._setUINavPos(index);\r\n    if (typeof (index) === \"number\") {\r\n        if (this.curr === index) {\r\n            this.stories[index].style.display = \"block\";\r\n            this.setCurrIndexBlock = true;\r\n            setTimeout(() => {\r\n                this.stories[index].style.visibility = \"visible\";\r\n                this.stories[index].style.opacity = \"1\";\r\n                this.stories[index].style.left = \"0px\";\r\n                this.setCurrIndexBlock = false;\r\n            }, 250);\r\n        } else {\r\n            // 隐藏\r\n            this.stories[this.curr].style.visibility = \"hidden\";\r\n            this.stories[this.curr].style.opacity = \"0\";\r\n            this.stories[this.curr].style.left = \"-30px\";\r\n\r\n            this.setCurrIndexBlock = true;\r\n            setTimeout(() => {\r\n                // 隐藏\r\n                this.stories[this.curr].style.display = \"none\";\r\n                this.stories[index].style.display = \"block\";\r\n                setTimeout(() => {\r\n                    this.stories[index].style.visibility = \"visible\";\r\n                    this.stories[index].style.opacity = \"1\";\r\n                    this.stories[index].style.left = \"0px\";\r\n                    this.setCurrIndexBlock = false;\r\n                    this.curr = index;\r\n                    if (typeof (cb) === \"function\") {\r\n                        cb();\r\n                    }\r\n                }, 250);\r\n            }, 250);\r\n        }\r\n    }\r\n}\r\n\r\nstoryState.prototype._getCurrIndex = function (index) {\r\n    return this.curr;\r\n}\r\n\r\nstoryState.prototype._setUINavPos = function (index) {\r\n    let selector = this.uiNavItems[0];\r\n    selector.style.top = this.uiNavItems[index + 1].offsetTop - 6 + \"px\";\r\n\r\n}\r\n\r\nstoryState.prototype._goStory = function (index) {\r\n    if (index >= 0 && index < this.storiesLen) {\r\n        this._setCurrIndex(index);\r\n    }\r\n}\r\n\r\nstoryState.prototype._upStory = function () {\r\n    if (this._getCurrIndex() > 0) {\r\n        this._setCurrIndex(this._getCurrIndex() - 1, () => {\r\n            let offsetHeight = this.storyOutterDOM.offsetHeight;\r\n            let scrollHeight = this.storyOutterDOM.scrollHeight;\r\n            this.storyOutterDOM.scrollTop = scrollHeight - offsetHeight;\r\n        })\r\n    }\r\n}\r\n\r\nstoryState.prototype._downStory = function () {\r\n    if (this._getCurrIndex() < this.storiesLen - 1) {\r\n        this._setCurrIndex(this._getCurrIndex() + 1, () => {\r\n            this.storyOutterDOM.scrollTop = 0;\r\n        })\r\n    }\r\n}\r\n\r\nlet _storyState = new storyState();\r\n\r\n","'use strict';\r\n\r\nimport foo from './lib/sr';\r\nimport nav from './lib/nav';\r\n\r\n"],"names":["storyState","storyOutterDOM","document","querySelector","uiNavItems","querySelectorAll","stories","children","storiesLen","length","i","style","visibility","display","opacity","position","left","curr","_setCurrIndex","len","selector","top","offsetTop","addEventListener","setCurrIndexBlock","_mouseWheel","bind","trigger","_triggerMobileNav","_untriggerMobileNav","event","stopPropagation","body","_touchHandler","contentArticle","prototype","touchY","deltaTouch","type","endTouch","startTouch","scrollTop","_upStory","offsetHeight","scrollHeight","_downStory","touches","clientY","navContainer","classList","remove","add","preventDefault","flag","ratio","animation","setInterval","deltaY","index","cb","_setUINavPos","_getCurrIndex","_goStory","_storyState"],"mappings":"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"}